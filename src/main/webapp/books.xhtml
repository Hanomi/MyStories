<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Title</title>
</h:head>

<h:body>
    <ui:composition template="/templates/library_template.xhtml">

        <ui:define name="title">
            #{lcl.library_title}
        </ui:define>

        <ui:define name="content">
            <p:growl life="2000" id="growlMessage" globalOnly="true"/>

            <p:dialog modal="true" widgetVar="dialogEditBook" dynamic="true" resizable="false" closable="false">
                <h:form id="formEditBook" rendered="#{request.isUserInRole('admin')}">
                    <p:panelGrid id="bookDetails" columns="2" columnClasses="col1, col2" styleClass="edit_book_table">
                        <strong>#{lcl.book_name}: </strong>
                        <p:inputText id="inputBookName" value="#{searchController.currentBook.name}" required="true"
                                     requiredMessage="#{lcl.required_field}" size="60"/>
                        <strong>#{lcl.author_name}: </strong>
                        <h:selectOneMenu value="#{searchController.currentBook.author}"
                                         converter="#{authorController}">
                            <f:selectItems value="${authorController.selectItems}"/>
                        </h:selectOneMenu>
                        <strong>#{lcl.genre}: </strong>
                        <h:selectOneMenu value="#{searchController.currentBook.genre}"
                                         converter="#{genreController}">
                            <f:selectItems value="${genreController.selectItems}"/>
                        </h:selectOneMenu>
                        <strong>#{lcl.publisher} </strong>
                        <h:selectOneMenu value="#{searchController.currentBook.publisher}"
                                         converter="#{publisherController}">
                            <f:selectItems value="${publisherController.selectItems}"/>
                        </h:selectOneMenu>
                        <strong>#{lcl.publishDate} </strong>
                        <p:inputText id="inputPublishDate" value="#{searchController.currentBook.publishYear}"
                                     required="true">
                            <f:convertDateTime pattern="dd.MM.yyyy"/>
                        </p:inputText>
                        <strong>#{lcl.isbn} </strong>
                        <p:inputText id="inputIsbn" value="#{searchController.currentBook.isbn}" required="true"/>
                        <strong>#{lcl.page_count} </strong>
                        <p:inputText id="inputPageCount" value="#{searchController.currentBook.pageCount}"
                                     required="true"/>
                        <strong>#{lcl.description} </strong>
                        <p:panel>
                            <p:inputTextarea id="inputDescr" value="#{searchController.currentBook.description}"
                                             cols="60"
                                             rows="20" maxlength="500" counter="counter"
                                             counterTemplate="#{lcl.letters_left} {0}"/>
                            <h:outputText id="counter"/>
                        </p:panel>
                        <p:commandButton styleClass="button-update" value="#{lcl.save}" onclick="this.disabled=true; PF('dialogEditBook').hide();"
                                         update=":formEditBook :booksForm:book_list :booksForm:books_count :growlMessage"
                                         action="#{searchController.updateBook()}"/>
                        <p:commandButton value="#{lcl.cancel}"
                                         onclick="PF('dialogEditBook').hide()"
                                         immediate="true" global="false"/>
                    </p:panelGrid>
                </h:form>
            </p:dialog>

            <h:form id="booksForm">
                <strong><h:outputText id="books_count"
                                      value="#{lcl.book_count} #{searchController.bookListDataModel.getRowCount()}"/></strong>

                <h:panelGroup id="adminTools" rendered="#{request.isUserInRole('admin')}">
                    <!--//todo ADD book button-->
                </h:panelGroup>


                <p:dataTable lazy="true" id="book_list" value="#{searchController.bookListDataModel}" var="b"
                             styleClass=""
                             paginator="true" rows="3" rowsPerPageTemplate="3,5,10"
                             paginatorTemplate="{RowsPerPageDropdown} {PageLinks}" paginatorAlwaysVisible="false"
                             emptyMessage="">
                    <p:column>
                        <h:graphicImage value="/image?id=#{b.id}" width="120"/>
                    </p:column>
                    <p:column>
                        <div>
                            <p>
                                <strong>
                                    <h:outputText value="#{b.name}"/>
                                </strong>
                            </p>
                            <p>
                                <strong>#{lcl.author_name}: </strong>
                                <h:outputText value="#{b.author.fio}"/>
                            </p>
                            <p>
                                <strong>#{lcl.genre}: </strong>
                                <h:outputText value="#{b.genre.name}"/>
                            </p>
                            <p>
                                <strong>#{lcl.page_count}: </strong>
                                <h:outputText value="#{b.pageCount}"/>
                            </p>
                            <p>
                                <strong>#{lcl.publisher}: </strong>
                                <h:outputText value="#{b.publisher.name}"/>
                            </p>
                            <p>
                                <strong>#{lcl.publishDate}: </strong>
                                <h:outputText value="#{b.publishYear}">
                                    <f:convertDateTime pattern="dd.MM.yyyy"/>
                                </h:outputText>
                            </p>
                            <p>
                                <strong>#{lcl.isbn}: </strong>
                                <h:outputText value="#{b.isbn}"/>
                            </p>
                            <p>
                                <h:panelGroup>
                                    <h:outputLink value="#{request.contextPath}/read" target="_blank">
                                        <h:outputText value="#{lcl.read}"/>
                                        <f:param name="id" value="#{b.id}"/>
                                    </h:outputLink>
                                    <h:outputLink value="#{request.contextPath}/download" target="_blank">
                                        <h:outputText value="#{lcl.download}"/>
                                        <f:param name="id" value="#{b.id}"/>
                                        <f:param name="filename" value="#{b.name}"/>
                                    </h:outputLink>
                                </h:panelGroup>
                            </p>
                        </div>
                    </p:column>
                    <p:column>
                        <div class="description">
                            <strong>#{lcl.description}: </strong>
                            <h:outputText value="#{b.description}"/>
                        </div>
                    </p:column>
                    <p:column rendered="#{request.isUserInRole('admin')}">
                        <p:commandLink title="#{lcl.edit_book}" onclick="PF('dialogEditBook').show()"
                                       update=":formEditBook:bookDetails">
                            <h:graphicImage library="images" name="edit.png"/>
                            <f:setPropertyActionListener value="#{b}" target="#{searchController.currentBook}"/>
                        </p:commandLink>
                        <p:commandLink title="#{lcl.delete_book}" type="button" onclick="PF('dialogDeleteBook').show()">
                            <h:graphicImage library="images" name="delete.png"/>
                            <f:setPropertyActionListener value="#{b}" target="#{searchController.currentBook}"/>
                        </p:commandLink>
                    </p:column>
                </p:dataTable>

                <p:confirmDialog widgetVar="dialogDeleteBook" header="#{lcl.confirm}" message="#{lcl.delete_confirm}?"
                                 width="300px" styleClass="dialog_delete">
                    <h:panelGrid columns="2" style="margin:0 auto; width:150px;">
                        <p:commandButton id="btnDeletedBook" value="#{lcl.yes}"
                                         action="#{searchController.deleteBook()}"
                                         update=":booksForm:book_list :booksForm:books_count :growlMessage"
                                         onclick="PF('dialogDeleteBook').hide()"/>
                        <p:commandButton value="#{lcl.no}" styleClass="ui-confirmdialog-no" icon="ui-icon-close"
                                         onclick="PF('dialogDeleteBook').hide()" type="button"/>
                    </h:panelGrid>
                </p:confirmDialog>
            </h:form>
        </ui:define>

    </ui:composition>
</h:body>

</html>